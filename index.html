<!DOCTYPE html>
<html>
<head>
    <title>–°–≤–æ–±–æ–¥–Ω—ã–µ —Ä—É–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ... –≤–∞—à —Å—Ç–∏–ª—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
    </style>
</head>
<body>
    <div class="form-group">
        <input type="text" 
               id="name" 
               placeholder="–í–∞—à–µ –∏–º—è"
               required>
    </div>
    <div class="form-group">
        <input type="tel" 
               id="phone" 
               placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–ø—Ä–∏–º–µ—Ä: 79001234567)"
               pattern="\+?\d{10,15}"
               required>
    </div>

    <button onclick="submitForm('callback')">üìû –ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫</button>
    <button onclick="submitForm('delivery')">ü§ù –°–≤–æ–±–æ–¥–Ω—ã–µ —Ä—É–∫–∏</button>

    <script>
        // 1. –Ø–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        const tg = window.Telegram.WebApp;
        
        // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ WebApp
        if (!tg || !tg.initData) {
            alert("–û—à–∏–±–∫–∞: Mini App –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!");
            tg.close();
        }

        // 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MainButton
        tg.MainButton
            .setText("–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É")
            .hide()
            .onClick(() => submitForm('default')); // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è MainButton

        // 4. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        function validate() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const isValid = name && /^\+?\d{10,15}$/.test(phone);
            
            tg.MainButton[isValid ? 'show' : 'hide']();
            return isValid;
        }

        // 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function submitForm(type) {
            const formData = {
                name: document.getElementById('name').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                type: type
            };

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!formData.name) {
                tg.showAlert("‚ùó –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è!");
                return;
            }
            
            if (!/^\+?\d{10,15}$/.test(formData.phone)) {
                tg.showAlert("‚ùó –¢–µ–ª–µ—Ñ–æ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ 79001234567");
                return;
            }

            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
            console.log("[DEBUG] –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:", formData);
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞
            tg.sendData(JSON.stringify(formData));
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ
            setTimeout(() => {
                console.log("[DEBUG] –ó–∞–∫—Ä—ã—Ç–∏–µ Mini App");
                tg.close();
            }, 300);
        }

        // 6. –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('name').addEventListener('input', validate);
        document.getElementById('phone').addEventListener('input', validate);
        
        // 7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.ready();
        console.log("[DEBUG] Mini App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
    </script>
</body>
</html>
